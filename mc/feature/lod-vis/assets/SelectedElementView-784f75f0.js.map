{"version":3,"file":"SelectedElementView-784f75f0.js","sources":["../../src/UI/BigComponents/SelectedElementView.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import type { Feature } from \"geojson\"\n  import { Store, UIEventSource } from \"../../Logic/UIEventSource\"\n  import LayerConfig from \"../../Models/ThemeConfig/LayerConfig\"\n  import type { SpecialVisualizationState } from \"../SpecialVisualization\"\n  import TagRenderingEditable from \"../Popup/TagRendering/TagRenderingEditable.svelte\"\n  import { onDestroy } from \"svelte\"\n  import Translations from \"../i18n/Translations\"\n  import Tr from \"../Base/Tr.svelte\"\n  import TagRenderingConfig from \"../../Models/ThemeConfig/TagRenderingConfig\"\n\n  export let state: SpecialVisualizationState\n  export let layer: LayerConfig\n  export let selectedElement: Feature\n  export let highlightedRendering: UIEventSource<string> = undefined\n\n  export let tags: UIEventSource<Record<string, string>> = state?.featureProperties?.getStore(\n    selectedElement.properties.id\n  )\n  \n  \n  let stillMatches = tags.map(tags => !layer?.source?.osmTags || layer.source.osmTags?.matchesProperties(tags))\n\n  let _metatags: Record<string, string>\n  if(state?.userRelatedState?.preferencesAsTags){\n    \n  onDestroy(\n    state.userRelatedState.preferencesAsTags.addCallbackAndRun((tags) => {\n      _metatags = tags\n    })\n  )\n  }\n\n  let knownTagRenderings: Store<TagRenderingConfig[]> = tags.mapD((tgs) =>\n    layer.tagRenderings.filter(\n      (config) =>\n        (config.condition?.matchesProperties(tgs) ?? true) &&\n        (config.metacondition?.matchesProperties({ ...tgs, ..._metatags }) ?? true) &&\n        config.IsKnown(tgs)\n    )\n  )\n</script>\n\n{#if !$stillMatches}\n  <div class=\"alert\"  aria-live=\"assertive\">\n    <Tr t={Translations.t.delete.isChanged}/>\n  </div>\n{:else if $tags._deleted === \"yes\"}\n  <div aria-live=\"assertive\">\n    <Tr t={Translations.t.delete.isDeleted} />\n  </div>\n  <button class=\"w-full\" on:click={() => state.selectedElement.setData(undefined)}>\n    <Tr t={Translations.t.general.returnToTheMap} />\n  </button>\n{:else}\n  <div\n    class=\"selected-element-view flex h-full w-full flex-col gap-y-2 overflow-y-auto p-1 px-4\"\n    tabindex=\"-1\"\n  >\n    {#each $knownTagRenderings as config (config.id)}\n      <TagRenderingEditable\n        {tags}\n        {config}\n        {state}\n        {selectedElement}\n        {layer}\n        {highlightedRendering}\n        clss={$knownTagRenderings.length === 1\n          ? \"h-full\"\n          : \"tr-length-\" + $knownTagRenderings.length}\n      />\n    {/each}\n  </div>\n{/if}\n"],"names":["ctx","get_key","i","insert","target","div","anchor","Translations","button","state","$$props","layer","selectedElement","highlightedRendering","tags","_a","stillMatches","_b","_metatags","onDestroy","knownTagRenderings","tgs","config","click_handler"],"mappings":"sgBA2DWA,EAAmB,CAAA,EAAY,MAAAC,EAAAD,GAAAA,MAAO,mBAA3C,OAAIE,GAAA,EAAA,sOAJRC,EAiBKC,EAAAC,EAAAC,CAAA,0EAbIN,EAAmB,CAAA,wEAAxB,OAAIE,GAAA,sKAVC,MAAA,CAAA,EAAAK,EAAa,EAAE,OAAO,SAAS,aAG/B,MAAA,CAAA,EAAAA,EAAa,EAAE,QAAQ,cAAc,qIAJ9CJ,EAEKC,EAAAC,EAAAC,CAAA,uBACLH,EAEQC,EAAAI,EAAAF,CAAA,wPARC,MAAA,CAAA,EAAAC,EAAa,EAAE,OAAO,SAAS,+FADxCJ,EAEKC,EAAAC,EAAAC,CAAA,+PAqBON,EAAmB,CAAA,EAAC,SAAW,EACjC,SACA,aAAeA,EAAmB,CAAA,EAAC,8RAFjCA,EAAmB,CAAA,EAAC,SAAW,EACjC,SACA,aAAeA,EAAmB,CAAA,EAAC,iLA1BzCA,EAAa,CAAA,EAITA,EAAK,CAAA,EAAC,WAAa,MAAK,IAJf,kZAhCN,MAAAS,CAAA,EAAAC,GACA,MAAAC,CAAA,EAAAD,GACA,gBAAAE,CAAA,EAAAF,EACA,CAAA,qBAAAG,QAA8C,EAAAH,GAE9C,KAAAI,GAA8CC,EAAAN,GAAA,YAAAA,EAAO,oBAAP,YAAAM,EAA0B,SACjFH,EAAgB,WAAW,GAAA,EAAAF,UAIzBM,EAAeF,EAAK,IAAIA,GAAAA,SAAAA,SAASC,EAAAJ,GAAA,YAAAA,EAAO,SAAP,MAAAI,EAAe,YAAWE,EAAAN,EAAM,OAAO,UAAb,YAAAM,EAAsB,kBAAkBH,IAAI,yBAEvGI,GACDD,EAAAR,GAAA,YAAAA,EAAO,mBAAP,MAAAQ,EAAyB,mBAE5BE,EACEV,EAAM,iBAAiB,kBAAkB,kBAAmBK,GAAAA,CAC1DI,EAAYJ,KAKZ,IAAAM,EAAkDN,EAAK,KAAMO,GAC/DV,EAAM,cAAc,OACjBW,GAAA,SACE,SAAAP,EAAAO,EAAO,YAAP,YAAAP,EAAkB,kBAAkBM,KAAQ,QAC5CJ,EAAAK,EAAO,gBAAP,YAAAL,EAAsB,kBAAA,CAAA,GAAuBI,EAAQ,GAAAH,CAAA,KAAgB,KACtEI,EAAO,QAAQD,CAAG,EAAA,CAAA,qBAae,MAAAE,EAAA,IAAAd,EAAM,gBAAgB,QAAQ,MAAS"}